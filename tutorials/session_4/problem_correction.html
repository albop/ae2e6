<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Macro II - Fluctuations - Part II - A two agents model of inequalities.</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/quarto-listing/list.min.js"></script>
<script src="../../site_libs/quarto-listing/quarto-listing.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>

  window.document.addEventListener("DOMContentLoaded", function (_event) {
    const listingTargetEl = window.document.querySelector('#listing-mod-listings .list');
    if (!listingTargetEl) {
      // No listing discovered, do not attach.
      return; 
    }

    const options = {
      valueNames: ['listing-filename',{ data: ['index'] },{ data: ['categories'] },{ data: ['listing-date-sort'] },{ data: ['listing-file-modified-sort'] }],
      
      searchColumns: ["listing-filename","listing-file-modified"],
    };

    window['quarto-listings'] = window['quarto-listings'] || {};
    window['quarto-listings']['listing-mod-listings'] = new List('listing-mod-listings', options);

    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  });

  window.addEventListener('hashchange',() => {
    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  })
  </script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">
      Macro II - Fluctuations - Part II
      </li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Macro II - Fluctuations - Part II</a> 
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">lectures</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/session_1/handout.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Solving DSGE models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/session_2/handout.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Small Open Economy Extension (IRBC)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/session_3/handout.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to Heterogeneity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/session_4/handout.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Financial Intermediation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/session_1/problem.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to DSGE Model &amp; Julia Basics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/session_2/problem.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">First steps with Dynare and moment matching.</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/session_3/problem.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Opening Economy Extension</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#preference-for-wealth-and-marginal-propensity-to-consume" id="toc-preference-for-wealth-and-marginal-propensity-to-consume" class="nav-link active" data-scroll-target="#preference-for-wealth-and-marginal-propensity-to-consume">Preference for wealth and marginal propensity to consume</a></li>
  <li><a href="#a-two-agents-model" id="toc-a-two-agents-model" class="nav-link" data-scroll-target="#a-two-agents-model">A two agents model</a></li>
  <li><a href="#calibrating-and-simulating-the-model" id="toc-calibrating-and-simulating-the-model" class="nav-link" data-scroll-target="#calibrating-and-simulating-the-model">Calibrating and simulating the model</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="index_correction.out.ipynb" download="index_correction.out.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">A two agents model of inequalities.</h1>
<p class="subtitle lead">Business Cycles and Fluctuations - AE2E6</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-tip callout-titled" title="Modfiles">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Modfiles
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="listing-mod-listings" class="quarto-listing quarto-listing-container-default">
<div class="list quarto-listing-default">
<div class="quarto-post image-right" data-index="0" data-listing-file-modified-sort="1715866705448">
<div class="body">

</div>
<div class="metadata">
<p><a href="../../tutorials/session_4/one_agent.mod" class="no-external"></a></p><a href="../../tutorials/session_4/one_agent.mod" class="no-external">
<div class="metadata-value listing-filename">
one_agent.mod
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="1" data-listing-file-modified-sort="1715867777833">
<div class="body">

</div>
<div class="metadata">
<p><a href="../../tutorials/session_4/one_agent_2.mod" class="no-external"></a></p><a href="../../tutorials/session_4/one_agent_2.mod" class="no-external">
<div class="metadata-value listing-filename">
one_agent_2.mod
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="2" data-listing-file-modified-sort="1715868192528">
<div class="body">

</div>
<div class="metadata">
<p><a href="../../tutorials/session_4/two_agents.mod" class="no-external"></a></p><a href="../../tutorials/session_4/two_agents.mod" class="no-external">
<div class="metadata-value listing-filename">
two_agents.mod
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="3" data-listing-file-modified-sort="1715868401195">
<div class="body">

</div>
<div class="metadata">
<p><a href="../../tutorials/session_4/two_agents_mps.mod" class="no-external"></a></p><a href="../../tutorials/session_4/two_agents_mps.mod" class="no-external">
<div class="metadata-value listing-filename">
two_agents_mps.mod
</div>
</a>
</div>
</div>
</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div>
</div>
</div>
</div>
<p>Uncomment the following lines to install needed packages (if not already present).</p>
<div id="cell-3" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># uncomment the next lines, the first time you run</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># import Pkg; Pkg.add(["DBnomics", "Dynare", "DataFrames"])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="preference-for-wealth-and-marginal-propensity-to-consume" class="level2">
<h2 class="anchored" data-anchor-id="preference-for-wealth-and-marginal-propensity-to-consume">Preference for wealth and marginal propensity to consume</h2>
<p>For now, we consider a single representative agent. She has the ability to buy a two periods bond, yielding 1 after one period. The price of the bond at any date is <span class="math inline">\(q\)</span>, hence its (riskfree) interest rate is <span class="math inline">\(r=1/q\)</span>.</p>
<p>Agent values consumption <span class="math inline">\(c_t\)</span> and wealth <span class="math inline">\(b_t q_t\)</span> so that she maximizes<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>:</p>
<p><span class="math display">\[\max \sum_t \beta^t \left( \frac{c_t^{1-\frac{1}{\sigma}}}{1-\frac{1}{\sigma}}+ \varphi \frac{ (1+b_t)^{1-\frac{1}{\eta}} } {1-\frac{1}{\eta}} \right)\]</span></p>
<p>under the budget constraint</p>
<p><span class="math display">\[c_t = y_t + b_{t-1} - b_t q_t\]</span></p>
<p>where <span class="math inline">\(y_t\)</span> is exogenous income following AR1</p>
<p><span class="math display">\[(y_t-\overline{y})=\rho (y_{t-1}-\overline{y}) + \epsilon^y_t\]</span></p>
<div id="cell-5" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Dynare</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol class="example" type="1">
<li><strong>Write down the optimality condition for debt holdings.</strong></li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled" title="Correction">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Correction
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We get:</p>
<p><span class="math display">\[q_t = \beta \left(\frac{c_{t+1}}{c_{t}}\right)^{-\frac{1}{\sigma}}+\varphi \left(\frac{1 + b_t q_t}{c_{t}}\right)^{-\frac{1}{\sigma}}\]</span></p>
</div>
</div>
</div>
<p><strong>What are the equations defining the deterministic equilibrium?</strong></p>
<div class="callout callout-style-default callout-warning callout-titled" title="Correction">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Correction
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>At the equilibium, the last equation becomes. <span class="math display">\[q = \beta + \varphi \left(\frac{1 + b q}{c}\right)^{-\frac{1}{\sigma}}\]</span></p>
</div>
</div>
</div>
<p><strong>3. Inspect and run <code>one_agent.mod</code> model. Show that there is a unit root. Can you interpret it?</strong></p>
<div class="callout callout-style-default callout-warning callout-titled" title="Correction">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Correction
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The <code>one_agent.mod</code> model is a standard consumption saving model without preference for wealth.</p>
<p>In general, if the solution of a model is $y_t = A y_{t-1} where <span class="math inline">\(y_t\)</span> is the vector of variables, we have a unit root when one of the eigenvalues of A is equal to 1 in absolute terms.</p>
<p>In the specific case of the modfile. We can directly read the values of matrix <span class="math inline">\(A\)</span> are given in the output of dynare (precisely it is a subset of <span class="math inline">\(A'\)</span>)</p>
<pre><code>  Coefficients of approximate solution function (reduced form)

───────┬──────────────────
       │ y_t   c_t    b_t
──────────────────────────
  ϕ(b) │ 0.0  0.0385  1.0
 e_y_t │ 0.1  0.0038  0.1
───────┴──────────────────</code></pre>
<p>The rows correspond to the (predetermined) states. Non predetermined variables do not appear as rows (or equivalently with zeros everywhere).</p>
<p>Here we see that <span class="math inline">\(b_t\)</span> is the only endogenous state. We also see that its dynamic is given by:</p>
<p>In particular, we see rule: <span class="math inline">\(b_t = 1.0 b_{t-1} + 0.1 e_{y,t}\)</span>.</p>
<p>In other words, the dynamic of <span class="math inline">\(b\)</span> is an AR1 with perfect persistence.</p>
<p>This behaviour (like in an open economy) comes from the fact that any steady-state level of debt is feasible (in a deterministic model). Hence shocks can affect the steady-state permanently.</p>
</div>
</div>
</div>
<div id="cell-12" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@dynare</span>(<span class="st">"one_agent.mod"</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Dynare version: 0.9.11
2024-05-16T15:39:08.946: Starting @dynare one_agent.mod
["one_agent.mod", "language=julia", "json=compute"]
Dynare preprocessor version: 6.4.0+0
2024-05-16T15:39:08.950: End of preprocessing
2024-05-16T15:39:08.953: Start parse_statements!
  Steady state

───┬─────
 y │ 1.0
 c │ 1.0
 b │ 0.0
───┴─────

  Coefficients of approximate solution function (reduced form)

───────┬──────────────────
       │ y_t   c_t    b_t
──────────────────────────
  ϕ(b) │ 0.0  0.0385  1.0
 e_y_t │ 0.1  0.0038  0.1
───────┴──────────────────

  Note: ϕ(x) = x_{t-1} - steady_state(x)

  THEORETICAL MOMENTS

──────────┬───────────────────────────
 VARIABLE │ MEAN  STD. DEV.  VARIANCE
──────────────────────────────────────
        y │  1.0      0.001       0.0
        c │  NaN        NaN       NaN
        b │  NaN        NaN       NaN
──────────┴───────────────────────────

  VARIANCE DECOMPOSITION (in percent)

──────────┬─────
 VARIABLE │ e_y
────────────────
        y │ 1.0
──────────┴─────

  CORRELATION MATRIX

───┬─────
   │  y
─────────
 y │ 1.0
───┴─────

  AUTOCORRELATION COEFFICIENTS

───┬─────────────────────────
   │  1    2     3    4    5
─────────────────────────────
 y │ 0.0  0.0  0.0  0.0  0.0
───┴─────────────────────────

2024-05-16T15:39:08.990: End parse_statements!
2024-05-16T15:39:08.990: End parser</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Starting preprocessing of the model file ...
Found 3 equation(s).
Evaluating expressions...
Computing static model derivatives (order 1).
Normalizing the static model...
Normalization failed with cutoff, trying symbolic normalization...
Could not normalize the static model. Variable b is not in the maximum cardinality matching.
Computing dynamic model derivatives (order 1).
Normalizing the dynamic model...
Finding the optimal block decomposition of the dynamic model...
3 block(s) found:
  3 recursive block(s) and 0 simultaneous block(s).
  the largest simultaneous block has 0 equation(s)
                                 and 0 feedback variable(s).
JSON written after Computing step.
Preprocessing completed.










</code></pre>
</div>
</div>
<ol start="2" class="example" type="1">
<li><strong>What is the consumption response to a temporary income shock? To a permanent one? (with autocorrelation <span class="math inline">\(\rho=0.9\)</span> and <span class="math inline">\(\rho=1.0\)</span>)</strong></li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled" title="Correction">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Correction
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Change the income equation:</p>
<ul>
<li>for a temporary shock remove the zero to get: <code>y = ybar + e_y</code></li>
<li>For a persistent one, define a new parameter in the parameters line initialized to <code>rho=0.9</code> and change the equation to <code>y - ybar = rho*(y(-1) - ybar) + e_y</code>. In the case <code>rho=1.0</code> note the apparition of a second unit root.</li>
</ul>
<p>In the simulations, pay attention to the magnitude of the shock <code>e_y</code> (1% by default) to compare it to the magnitude of the response for assets <code>b</code>.</p>
</div>
</div>
</div>
<ol start="3" class="example" type="1">
<li><strong>In the modfile, add a preference for wealth term in the utility function and adjust the calibration of <code>beta</code> accordingly.</strong></li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled" title="Correction">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Correction
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Parameters <code>phi</code> and <code>eta</code> are already predefined.</p>
<p>Add <code>+ phi*(1+b*q)^(-1/eta)/(c^(-1/sigma))</code> to the Euler equation and <code>beta = 1/r - phi*(1+bbar*q)^(-1/eta)/(cbar^(-1/sigma));</code> in the definition of parameters</p>
<p>The simulation runs, only when the command <code>check</code> succeeds, in particular, when the steady-sate is satisfied. If it is not the case, you need to adjust the equations/calibration.</p>
<p>Result is in the <code>one_agent_2.mod</code> file.</p>
<p>Here we see that one unit root has disappeared, because pref. for wealth pins down equilibrium asset holdings.</p>
</div>
</div>
</div>
<p><strong>6. Simulate the response to a temporary and a persistent shock. Given <code>phi</code> what is the effect of <code>eta</code>?</strong></p>
<div class="callout callout-style-default callout-warning callout-titled" title="Correction">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Correction
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Now the savings response to transitory shock is mean reverting, while the response to a persistent shock is persistent and even increasing over time.</p>
<p><code>eta</code> affects the long run savings level in response to a temporary income shock. (If curious you should be able to check it does not depend on phi).</p>
</div>
</div>
</div>
</section>
<section id="a-two-agents-model" class="level2">
<h2 class="anchored" data-anchor-id="a-two-agents-model">A two agents model</h2>
<p>We now assume there are two agents: bottom and top earners. Top earners amount for a fraction <span class="math inline">\(\chi\)</span> of the total population. Together they earn a fraction <span class="math inline">\(z\in[0,1]\)</span> of the total production <span class="math inline">\(y\)</span> which is an AR1 process as in the first part. The rest goes to the bottom earners.</p>
<p>Top earners can save by lending to bottom earners. We denote by <span class="math inline">\(B_t\)</span> the total quantity of riskfree bonds, traded at <span class="math inline">\(q_t\)</span>. Note that debt per capita is <span class="math inline">\(\frac{B_t}{\chi}\)</span> for top earners and <span class="math inline">\(\frac{B_t}{1-\chi}\)</span> for bottom earners. Top earners have preference for wealth as in the first part, while bottom earners have standard preferences (with <span class="math inline">\(\varphi=0\)</span>)</p>
<ol start="4" class="example" type="1">
<li><strong>Write down the budget equations for both agents. What are the new Euler equations? Check that it is consistent with the <code>two_agents.mod</code> modfile. What are the per capita variables?</strong></li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled" title="Correction">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Correction
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Budget constraints are included in the modfile.</p>
<p>Per capita variables: <code>c_t</code>, <code>c_b</code>, <code>b_t</code> and <code>b_b</code>.</p>
</div>
</div>
</div>
<ol start="5" class="example" type="1">
<li><strong>What is qualitatively the effect of a permanent redistributive shock? (simulate the model)</strong></li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled" title="Correction">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Correction
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>With increased income, top earners want to increase their asset holdings. This will happen since bottom earners are indifferent in the steady-state. During the transition however, we see a decrease in the interest rate (to convince borrower to accept a decreasing path of consumption over time).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="two_agents/graphs/irfs_e_z_1.png" class="img-fluid figure-img"></p>
<figcaption>Response to a redistributive shock</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div id="cell-24" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@dynare</span>(<span class="st">"two_agents.mod"</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Dynare version: 0.9.11
2024-05-16T16:04:04.483: Starting @dynare two_agents.mod
["two_agents.mod", "language=julia", "json=compute"]
Dynare preprocessor version: 6.4.0+0
2024-05-16T16:04:04.488: End of preprocessing
2024-05-16T16:04:04.493: Start parse_statements!
  Coefficients of approximate solution function (reduced form)

────────┬─────────────────────────────────────────────────────────────────────────
        │ y_t   z_t   c_t_t    c_b_t    b_t_t    b_b_t     B_t       q_t      r_t
──────────────────────────────────────────────────────────────────────────────────
   ϕ(y) │  0.9  0.0   2.4446   0.8187   -2.4617  0.1296  -0.1231  0.1745  -0.1887
   ϕ(z) │  0.0  1.0  17.9241  -0.9434    1.9191  -0.101    0.096  0.0127  -0.0137
 ϕ(b_t) │ -0.0  0.0   0.1658   0.0439   -0.9495    0.05  -0.0475   0.096  -0.1038
 ϕ(b_b) │ -0.0  0.0   2.1269   0.8881  -36.7706  1.9353  -1.8385  1.8258  -1.9748
  e_y_t │  1.0  0.0   2.7162   0.9097   -2.7352   0.144  -0.1368  0.1938  -0.2097
  e_z_t │ -0.0  1.0  17.9241  -0.9434    1.9191  -0.101    0.096  0.0127  -0.0137
────────┴─────────────────────────────────────────────────────────────────────────

  Note: ϕ(x) = x_{t-1} - steady_state(x)

  THEORETICAL MOMENTS

──────────┬─────────────────────────────
 VARIABLE │  MEAN   STD. DEV.  VARIANCE
────────────────────────────────────────
        y │    1.0     0.0229    0.0005
        z │    NaN        NaN       NaN
      c_t │    NaN        NaN       NaN
      c_b │    NaN        NaN       NaN
      b_t │    NaN        NaN       NaN
      b_b │    NaN        NaN       NaN
        B │    NaN        NaN       NaN
        q │ 0.9615     0.0046       0.0
        r │   1.04      0.005       0.0
──────────┴─────────────────────────────

  VARIANCE DECOMPOSITION (in percent)

──────────┬────────────────
 VARIABLE │  e_y     e_z
───────────────────────────
        y │    1.0    -0.0
        q │ 0.9249  0.0751
        r │ 0.9249  0.0751
──────────┴────────────────

  CORRELATION MATRIX

───┬──────────────────────────
   │    y       q        r
──────────────────────────────
 y │     1.0  0.9617  -0.9617
 q │  0.9617     1.0     -1.0
 r │ -0.9617    -1.0      1.0
───┴──────────────────────────

  AUTOCORRELATION COEFFICIENTS

───┬────────────────────────────────────────
   │   1       2       3       4          5
────────────────────────────────────────────
 y │    0.9    0.81   0.729  0.6561  0.5905
 q │ 0.8324  0.7492  0.6742  0.6068  0.5461
 r │ 0.8324  0.7492  0.6742  0.6068  0.5461
───┴────────────────────────────────────────

2024-05-16T16:04:04.599: End parse_statements!
2024-05-16T16:04:04.599: End parser</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Starting preprocessing of the model file ...
Found 9 equation(s).
Evaluating expressions...
Computing static model derivatives (order 1).
Normalizing the static model...
Finding the optimal block decomposition of the static model...
6 block(s) found:
  5 recursive block(s) and 1 simultaneous block(s).
  the largest simultaneous block has 2 equation(s)
                                 and 2 feedback variable(s).
Computing dynamic model derivatives (order 1).
Normalizing the dynamic model...
Finding the optimal block decomposition of the dynamic model...
3 block(s) found:
  2 recursive block(s) and 1 simultaneous block(s).
  the largest simultaneous block has 6 equation(s)
                                 and 6 feedback variable(s).
JSON written after Computing step.
Preprocessing completed.










</code></pre>
</div>
</div>
</section>
<section id="calibrating-and-simulating-the-model" class="level2">
<h2 class="anchored" data-anchor-id="calibrating-and-simulating-the-model">Calibrating and simulating the model</h2>
<p>The model in the modefile is pre-calibrated to match US data in 1983. Assume the model is in equilibrium for an initial level of debt <span class="math inline">\(B=0.91\)</span> (which is the debt/gdp ratio in the us in 1983).</p>
<p>Taking <span class="math inline">\(\varphi=0.05\)</span> as constant, for any given choice of <span class="math inline">\(\eta\)</span>, there is a unique value of <span class="math inline">\(\beta\)</span> consistent with the equilibrium as in the one agent case.</p>
<p>Now we would like to calibrate the value of <span class="math inline">\(\eta\)</span> so as to match the marginal propensity to save of top earners which was approximately 50% in 1983.</p>
<p>Since the two agents model is already calibrated for most variables, we reuse it rather than adapting the one agent model.</p>
<ol start="6" class="example" type="1">
<li><strong>In the model <code>two_agents.mod</code> replace the Euler equation of bottom earner by <code>q = 1/rbar</code>. Justify why, from the top earners perspective, the model is now equivalent to a single agent model.</strong></li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled" title="Correction">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Correction
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Interest rate is the only manifestation of bottom earners preferences in the model. If we set it equal to a constant, top earners are now facing an infinitely elastic demand of bonds as in the one agent case.</p>
</div>
</div>
</div>
<p><strong>@. Use the modified model to compute the marginal propensity out of a permanent income shock after 6 periods. Choose parameter <code>eta</code> so that this m.p.s. is approximatively 50%.</strong></p>
<div class="callout callout-style-default callout-warning callout-titled" title="Correction">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Correction
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Several options here. We can just make a persistent shock of size sig_z to the overall income <span class="math inline">\(y\)</span> and compute the marginal propensity to save at different periods (variable mps). It must be normalized by the initial income level of top earners. We can then run computations for different values of <span class="math inline">\(eta\)</span> until we find the desired value.</p>
<p>Modified model is <code>two_agents_mps.mps</code>. I found eta=0.6 to be a good calibration.</p>
</div>
</div>
</div>
<div id="cell-30" class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@dynare</span>(<span class="st">"two_agents_mps.mps"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="7" class="example" type="1">
<li><strong>What is the effect of a 10% permanent increase in inequalities? Over 30 years and in the long run?</strong></li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled" title="Correction">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Correction
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Several options here. We can just make a persistent shock of size sig_z to the overall income <span class="math inline">\(y\)</span> and compute the marginal propensity to save at different periods (variable mps). It must be normalized by the initial income level of top earners. We can then run computations for different values of <span class="math inline">\(eta\)</span> until we find the desired value.</p>
<p>Modified model is <code>two_agents_mps.mps</code>. I found eta=0.6 to be a good calibration.</p>
</div>
</div>
</div>



</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>this is the “preference for wealth” specification<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>